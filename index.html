<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Or√ßamentos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #FF6B35 0%, #FFA500 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .logo-container {
            margin-bottom: 20px;
        }

        .logo {
            width: 250px;
            height: 100px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
            object-fit: contain;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #FF6B35;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input[readonly] {
            background: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            border-color: #dee2e6;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #FF6B35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #FF6B35 0%, #FFA500 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 107, 53, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(86, 171, 47, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .btn-danger:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(255, 65, 108, 0.3);
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .items-table th {
            background: linear-gradient(135deg, #FF6B35 0%, #FFA500 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .items-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .items-table tr:hover {
            background: #f8f9fa;
        }

        .total-section {
            background: linear-gradient(135deg, #FF6B35 0%, #FFA500 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: right;
            margin-top: 20px;
        }

        .total-section h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .total-section p {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Modal de Compartilhamento */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-header h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .modal-header p {
            color: #6c757d;
            font-size: 1rem;
        }

        .share-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .share-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .share-option:hover {
            border-color: #FF6B35;
            background: #fff5f2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.1);
        }

        .share-option-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            flex-shrink: 0;
        }

        .share-option-content h3 {
            margin: 0 0 5px 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .share-option-content p {
            margin: 0;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .download-icon { background: linear-gradient(135deg, #FF6B35 0%, #FFA500 100%); }
        .image-icon { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); }

        .modal-footer {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .btn-close {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn-close:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .success-message {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        /* Valida√ß√£o de campos */
        .form-group.error input,
        .form-group.error textarea {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }

        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
        }

        .form-group.error .error-message {
            display: block;
        }

        .form-group.success input {
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 15px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .logo {
                width: 200px;
                height: 80px;
            }
            
            .content {
                padding: 15px;
            }
            
            .section {
                padding: 20px 15px;
                margin-bottom: 25px;
            }
            
            .section h2 {
                font-size: 1.3rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .form-group input,
            .form-group textarea {
                padding: 15px;
                font-size: 16px; /* Evita zoom no iOS */
                border-radius: 12px;
            }
            
            .btn {
                padding: 15px 20px;
                font-size: 1.1rem;
                border-radius: 12px;
                min-height: 48px; /* Touch target m√≠nimo */
            }
            
            .items-table {
                font-size: 0.85rem;
                overflow-x: auto;
                display: block;
                white-space: nowrap;
            }
            
            .items-table thead,
            .items-table tbody,
            .items-table th,
            .items-table td,
            .items-table tr {
                display: block;
            }
            
            .items-table thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            
            .items-table tr {
                border: 1px solid #e9ecef;
                border-radius: 10px;
                margin-bottom: 10px;
                padding: 15px;
                background: white;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
            
            .items-table td {
                border: none;
                position: relative;
                padding: 8px 0 8px 35%;
                text-align: left;
                white-space: normal;
            }
            
            .items-table td:before {
                content: attr(data-label) ": ";
                position: absolute;
                left: 0;
                width: 30%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: bold;
                color: #FF6B35;
            }
            
            .total-section {
                padding: 20px;
                text-align: center;
            }
            
            .total-section h3 {
                font-size: 1.5rem;
            }
            
            .total-section p {
                font-size: 2rem;
            }
            
            .modal-content {
                padding: 25px 20px;
                margin: 20px;
                max-height: 90vh;
            }
            
            .modal-header h2 {
                font-size: 1.5rem;
            }
            
            .share-options {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .share-option {
                padding: 18px 15px;
            }
            
            .share-option-icon {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
            
            .empty-state svg {
                width: 60px;
                height: 60px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .logo {
                width: 150px;
                height: 60px;
            }
            
            .section h2 {
                font-size: 1.2rem;
            }
            
            .total-section h3 {
                font-size: 1.3rem;
            }
            
            .total-section p {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <img src="https://drive.google.com/uc?export=view&id=1_Rj0dAUGkBMIfDnmw7LxjKa_bWZcNQd0" 
                     alt="Fenix Fardamentos Logo" 
                     class="logo"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div style="display: none; color: white; font-size: 24px; font-weight: bold;">
                    üî• FENIX FARDAMENTOS
                </div>
            </div>
            <h1>Gerador de Or√ßamentos</h1>
        </div>

        <div class="content">
            <!-- Dados da Empresa -->
            <div class="section">
                <h2>üè¢ Dados da Empresa</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="empresaNome">Nome da Empresa *</label>
                        <input type="text" id="empresaNome" value="Fenix Fardamentos LTDA" required readonly>
                    </div>
                    <div class="form-group">
                        <label for="empresaCNPJ">CNPJ</label>
                        <input type="text" id="empresaCNPJ" value="12.000.234/0001-18" readonly>
                    </div>
                    <div class="form-group">
                        <label for="empresaEndereco">Endere√ßo</label>
                        <input type="text" id="empresaEndereco" value="Rua Pinheiro, 65 - Cidade Universit√°ria" readonly>
                    </div>
                    <div class="form-group">
                        <label for="empresaTelefone">Telefone</label>
                        <input type="text" id="empresaTelefone" value="(82) 98814-4752" readonly>
                        <div class="error-message">Formato inv√°lido. Use: (11) 99999-9999</div>
                    </div>
                    <div class="form-group">
                        <label for="empresaEmail">E-mail</label>
                        <input type="email" id="empresaEmail" value="fenixfardamentos.al@gmail.com" readonly>
                        <div class="error-message">Digite um e-mail v√°lido</div>
                    </div>
                </div>
            </div>

            <!-- Dados do Cliente -->
            <div class="section">
                <h2>üë§ Dados do Cliente</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="clienteNome">Nome do Cliente *</label>
                        <input type="text" id="clienteNome" placeholder="Nome completo ou empresa" required>
                    </div>
                    <div class="form-group">
                        <label for="clienteEmail">E-mail do Cliente</label>
                        <input type="email" id="clienteEmail" placeholder="cliente@email.com">
                        <div class="error-message">Digite um e-mail v√°lido</div>
                    </div>
                    <div class="form-group">
                        <label for="clienteTelefone">Telefone do Cliente</label>
                        <input type="text" id="clienteTelefone" placeholder="(11) 99999-9999">
                        <div class="error-message">Formato inv√°lido. Use: (11) 99999-9999</div>
                    </div>
                </div>
            </div>

            <!-- Adicionar Itens -->
            <div class="section">
                <h2>üì¶ Adicionar Itens ao Or√ßamento</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="itemDescricao">Descri√ß√£o do Item *</label>
                        <input type="text" id="itemDescricao" placeholder="CAMISA UV" required>
                    </div>
                    <div class="form-group">
                        <label for="itemQuantidade">Quantidade *</label>
                        <input type="number" id="itemQuantidade" min="1" value="1" required>
                    </div>
                    <div class="form-group">
                        <label for="itemValorUnitario">Valor Unit√°rio (R$) *</label>
                        <input type="number" id="itemValorUnitario" step="0.01" min="0" placeholder="0,00" required>
                    </div>
                </div>
                <button type="button" class="btn btn-primary" onclick="adicionarItem()">
                    ‚ûï Adicionar Item
                </button>
            </div>

            <!-- Lista de Itens -->
            <div class="section">
                <h2>üìã Itens do Or√ßamento</h2>
                <div id="itensContainer">
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        <h3>Nenhum item adicionado</h3>
                        <p>Adicione itens ao or√ßamento usando o formul√°rio acima</p>
                    </div>
                </div>
            </div>

            <!-- Observa√ß√µes -->
            <div class="section">
                <h2>üìù Observa√ß√µes</h2>
                <div class="form-group">
                    <label for="observacoes">Observa√ß√µes Adicionais</label>
                    <textarea id="observacoes" placeholder="Condi√ß√µes de pagamento, prazo de entrega, garantias, etc.">Forma de pagamento: 50% na encomenda e 50% na entrega.
Prazo de entrega: 30 dias a partir da confirma√ß√£o do pedido.</textarea>
                </div>
            </div>

            <!-- Gerar PDF -->
            <div class="section" style="text-align: center;">
                <button type="button" class="btn btn-success" onclick="gerarPDF()" style="font-size: 1.2rem; padding: 15px 30px;">
                    üìÑ Gerar Or√ßamento em PDF
                </button>
            </div>
        </div>
        
        <!-- Indicador de Vers√£o -->
        <div style="position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 15px; font-size: 11px; font-family: monospace; z-index: 1000;">
            v2.7.0
        </div>
    </div>

    <!-- Modal de Compartilhamento -->
    <div id="shareModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì§ Compartilhar Or√ßamento</h2>
                <p>Escolha como deseja compartilhar ou salvar seu or√ßamento</p>
            </div>

            <div id="successMessage" style="display: none;" class="success-message">
                ‚úÖ Or√ßamento processado com sucesso!
            </div>

            <div class="share-options">
                <div class="share-option" onclick="baixarPDF()">
                    <div class="share-option-icon download-icon">üìÑ</div>
                    <div class="share-option-content">
                        <h3>Baixar PDF</h3>
                        <p>Documento completo</p>
                    </div>
                </div>

                <div class="share-option" onclick="baixarImagem()">
                    <div class="share-option-icon image-icon">üñºÔ∏è</div>
                    <div class="share-option-content">
                        <h3>Baixar Imagem</h3>
                        <p>Resumo em JPEG</p>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-close" onclick="fecharModal()">Fechar</button>
            </div>
        </div>
    </div>

    <script>
        let itens = [];
        let contadorItens = 0;

        function adicionarItem() {
            const descricao = document.getElementById('itemDescricao').value.trim();
            const quantidade = parseInt(document.getElementById('itemQuantidade').value);
            const valorUnitario = parseFloat(document.getElementById('itemValorUnitario').value);

            if (!descricao || !quantidade || !valorUnitario) {
                alert('Por favor, preencha todos os campos do item.');
                return;
            }

            const item = {
                id: ++contadorItens,
                descricao,
                quantidade,
                valorUnitario,
                valorTotal: quantidade * valorUnitario
            };

            itens.push(item);
            atualizarTabelaItens();
            limparFormularioItem();
        }

        function removerItem(id) {
            itens = itens.filter(item => item.id !== id);
            atualizarTabelaItens();
        }

        function limparFormularioItem() {
            document.getElementById('itemDescricao').value = '';
            document.getElementById('itemQuantidade').value = '1';
            document.getElementById('itemValorUnitario').value = '';
        }

        function atualizarTabelaItens() {
            const container = document.getElementById('itensContainer');
            
            if (itens.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        <h3>Nenhum item adicionado</h3>
                        <p>Adicione itens ao or√ßamento usando o formul√°rio acima</p>
                    </div>
                `;
                return;
            }

            const totalGeral = itens.reduce((total, item) => total + item.valorTotal, 0);

            container.innerHTML = `
                <table class="items-table">
                    <thead>
                        <tr>
                            <th>Descri√ß√£o</th>
                            <th>Qtd</th>
                            <th>Valor Unit.</th>
                            <th>Total</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${itens.map(item => `
                            <tr>
                                <td data-label="Descri√ß√£o">${item.descricao}</td>
                                <td data-label="Qtd">${item.quantidade}</td>
                                <td data-label="Valor Unit.">R$ ${item.valorUnitario.toFixed(2).replace('.', ',')}</td>
                                <td data-label="Total">R$ ${item.valorTotal.toFixed(2).replace('.', ',')}</td>
                                <td data-label="A√ß√µes">
                                    <button class="btn btn-danger" onclick="removerItem(${item.id})">
                                        üóëÔ∏è Remover
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <div class="total-section">
                    <h3>Total Geral</h3>
                    <p>R$ ${totalGeral.toFixed(2).replace('.', ',')}</p>
                </div>
            `;
        }

        // Vari√°veis globais para o PDF
        let pdfGerado = null;
        let dadosOrcamento = null;

        function gerarPDF() {
            const empresaNome = document.getElementById('empresaNome').value.trim();
            const clienteNome = document.getElementById('clienteNome').value.trim();

            if (!empresaNome || !clienteNome) {
                alert('Por favor, preencha pelo menos o nome da empresa e do cliente.');
                return;
            }

            if (itens.length === 0) {
                alert('Adicione pelo menos um item ao or√ßamento.');
                return;
            }

            // Armazenar dados do or√ßamento
            dadosOrcamento = {
                empresaNome,
                clienteNome,
                totalGeral: itens.reduce((total, item) => total + item.valorTotal, 0)
            };

            // Gerar o PDF e abrir modal
            criarPDF();

        }

        function criarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Configura√ß√µes b√°sicas
            const pageWidth = doc.internal.pageSize.width;
            const margin = 20;
            let yPosition = 20;

            // Adicionar logo da empresa
            const logoImg = new Image();
            logoImg.crossOrigin = 'anonymous';
            logoImg.onload = function() {
                // Logo centralizada no topo
                const logoWidth = 60;
                const logoHeight = 25;
                const logoX = (pageWidth - logoWidth) / 2;
                
                doc.addImage(logoImg, 'PNG', logoX, yPosition, logoWidth, logoHeight);
                yPosition += logoHeight + 15;

                // Continuar com o resto do PDF
                continuarGeracaoPDF(doc, pageWidth, margin, yPosition);
            };
            
            logoImg.onerror = function() {
                // Se a logo n√£o carregar, continuar sem ela
                yPosition += 10;
                continuarGeracaoPDF(doc, pageWidth, margin, yPosition);
            };
            
            logoImg.src = 'https://drive.google.com/uc?export=view&id=1_Rj0dAUGkBMIfDnmw7LxjKa_bWZcNQd0';

        }

        function continuarGeracaoPDF(doc, pageWidth, margin, yPosition) {
            // Cabe√ßalho
            doc.setFontSize(24);
            doc.setFont('Roboto', 'bold');
            doc.setTextColor(44, 62, 80);
            doc.text('OR√áAMENTO', pageWidth / 2, yPosition, { align: 'center' });
            
            yPosition += 15;

            // Data do or√ßamento
            const dataAtual = new Date();
            const dataFormatada = dataAtual.toLocaleDateString('pt-BR');
            doc.setFontSize(10);
            doc.setFont('Roboto', 'normal');
            doc.setTextColor(120, 120, 120);
            doc.text(`Data: ${dataFormatada}`, pageWidth / 2, yPosition, { align: 'center' });
            
            yPosition += 20;

            // Dados da empresa
            doc.setFontSize(14);
            doc.setFont('Roboto', 'bold');
            doc.setTextColor(255, 107, 53);
            doc.text('DADOS DA EMPRESA:', margin, yPosition);
            yPosition += 10;

            doc.setFontSize(12);
            doc.setFont('Roboto', 'bold');
            doc.setTextColor(0, 0, 0);
            doc.text(dadosOrcamento.empresaNome, margin, yPosition);
            yPosition += 8;

                const empresaCNPJ = document.getElementById('empresaCNPJ').value.trim();
                const empresaEndereco = document.getElementById('empresaEndereco').value.trim();
                const empresaTelefone = document.getElementById('empresaTelefone').value.trim();
                const empresaEmail = document.getElementById('empresaEmail').value.trim();

                doc.setFontSize(10);
                doc.setFont('Roboto', 'normal');
                doc.setTextColor(80, 80, 80);
                
                if (empresaCNPJ) {
                    doc.text(`CNPJ: ${empresaCNPJ}`, margin, yPosition);
                    yPosition += 7;
                }
                if (empresaEndereco) {
                    doc.text(`Endere√ßo: ${empresaEndereco}`, margin, yPosition);
                    yPosition += 7;
                }
                if (empresaTelefone) {
                    doc.text(`Telefone: ${empresaTelefone}`, margin, yPosition);
                    yPosition += 7;
                }
                if (empresaEmail) {
                    doc.text(`E-mail: ${empresaEmail}`, margin, yPosition);
                    yPosition += 7;
                }

                yPosition += 15;

            // Dados do cliente
            doc.setFontSize(14);
            doc.setFont('Roboto', 'bold');
            doc.setTextColor(255, 107, 53);
            doc.text('CLIENTE:', margin, yPosition);
            yPosition += 10;

            doc.setFontSize(12);
            doc.setFont('Roboto', 'bold');
            doc.setTextColor(0, 0, 0);
            doc.text(dadosOrcamento.clienteNome, margin, yPosition);
            yPosition += 8;

            const clienteEmail = document.getElementById('clienteEmail').value.trim();
            const clienteTelefone = document.getElementById('clienteTelefone').value.trim();

            doc.setFontSize(10);
            doc.setFont('Roboto', 'normal');
            doc.setTextColor(80, 80, 80);
            
            if (clienteEmail) {
                doc.text(`E-mail: ${clienteEmail}`, margin, yPosition);
                yPosition += 7;
            }
            if (clienteTelefone) {
                doc.text(`Telefone: ${clienteTelefone}`, margin, yPosition);
                yPosition += 7;
            }

                yPosition += 20;

                // T√≠tulo da se√ß√£o de itens
                doc.setFontSize(14);
                doc.setFont('Roboto', 'bold');
                doc.setTextColor(255, 107, 53);
                doc.text('ITENS DO OR√áAMENTO:', margin, yPosition);
                yPosition += 15;

                // Criar tabela profissional
                const tableStartY = yPosition;
                const rowHeight = 12;
                const headerHeight = 15;
                
                // Definir larguras das colunas
                const colWidths = {
                    item: 15,
                    descricao: 85,
                    quantidade: 25,
                    valorUnit: 30,
                    total: 35
                };
                
                let currentX = margin;
                
                // Desenhar cabe√ßalho da tabela com fundo colorido
                doc.setFillColor(255, 107, 53);
                doc.rect(margin, yPosition - 3, pageWidth - 2 * margin, headerHeight, 'F');
                
                // Texto do cabe√ßalho
                doc.setFontSize(11);
                doc.setFont('Roboto', 'bold');
                doc.setTextColor(255, 255, 255);
                
                doc.text('ITEM', currentX + 2, yPosition + 8);
                currentX += colWidths.item;
                
                doc.text('DESCRI√á√ÉO', currentX + 2, yPosition + 8);
                currentX += colWidths.descricao;
                
                doc.text('QTD', currentX + colWidths.quantidade/2, yPosition + 8, { align: 'center' });
                currentX += colWidths.quantidade;
                
                doc.text('VALOR UNIT.', currentX + colWidths.valorUnit/2, yPosition + 8, { align: 'center' });
                currentX += colWidths.valorUnit;
                
                doc.text('TOTAL', currentX + colWidths.total/2, yPosition + 8, { align: 'center' });
                
                yPosition += headerHeight;

            // Itens da tabela
            doc.setFontSize(10);
            doc.setFont('Roboto', 'normal');
            doc.setTextColor(0, 0, 0);

            itens.forEach((item, index) => {
                // Verificar se precisa de nova p√°gina
                if (yPosition > 240) {
                    doc.addPage();
                    yPosition = 30;
                    
                    // Redesenhar cabe√ßalho na nova p√°gina
                    doc.setFillColor(255, 107, 53);
                    doc.rect(margin, yPosition - 3, pageWidth - 2 * margin, headerHeight, 'F');
                    
                    doc.setFontSize(11);
                    doc.setFont('Roboto', 'bold');
                    doc.setTextColor(255, 255, 255);
                    
                    currentX = margin;
                    doc.text('ITEM', currentX + 2, yPosition + 8);
                    currentX += colWidths.item;
                    doc.text('DESCRI√á√ÉO', currentX + 2, yPosition + 8);
                    currentX += colWidths.descricao;
                    doc.text('QTD', currentX + colWidths.quantidade/2, yPosition + 8, { align: 'center' });
                    currentX += colWidths.quantidade;
                    doc.text('VALOR UNIT.', currentX + colWidths.valorUnit/2, yPosition + 8, { align: 'center' });
                    currentX += colWidths.valorUnit;
                    doc.text('TOTAL', currentX + colWidths.total/2, yPosition + 8, { align: 'center' });
                    
                    yPosition += headerHeight;
                    
                    doc.setFontSize(10);
                    doc.setFont('Roboto', 'normal');
                    doc.setTextColor(0, 0, 0);
                }

                // Alternar cor de fundo das linhas
                if (index % 2 === 0) {
                    doc.setFillColor(248, 249, 250);
                    doc.rect(margin, yPosition - 2, pageWidth - 2 * margin, rowHeight, 'F');
                }
                
                // Desenhar bordas da tabela
                doc.setDrawColor(220, 220, 220);
                doc.setLineWidth(0.3);
                
                currentX = margin;
                
                // Coluna ITEM
                doc.line(currentX, yPosition - 2, currentX, yPosition + rowHeight - 2);
                doc.text((index + 1).toString(), currentX + colWidths.item/2, yPosition + 7, { align: 'center' });
                currentX += colWidths.item;
                
                // Coluna DESCRI√á√ÉO
                doc.line(currentX, yPosition - 2, currentX, yPosition + rowHeight - 2);
                const descricaoTruncada = item.descricao.length > 35 ? item.descricao.substring(0, 32) + '...' : item.descricao;
                doc.text(descricaoTruncada, currentX + 2, yPosition + 7);
                currentX += colWidths.descricao;
                
                // Coluna QUANTIDADE
                doc.line(currentX, yPosition - 2, currentX, yPosition + rowHeight - 2);
                doc.text(item.quantidade.toString(), currentX + colWidths.quantidade/2, yPosition + 7, { align: 'center' });
                currentX += colWidths.quantidade;
                
                // Coluna VALOR UNIT√ÅRIO
                doc.line(currentX, yPosition - 2, currentX, yPosition + rowHeight - 2);
                doc.text(`R$ ${item.valorUnitario.toFixed(2).replace('.', ',')}`, currentX + colWidths.valorUnit/2, yPosition + 7, { align: 'center' });
                currentX += colWidths.valorUnit;
                
                // Coluna TOTAL
                doc.line(currentX, yPosition - 2, currentX, yPosition + rowHeight - 2);
                doc.text(`R$ ${item.valorTotal.toFixed(2).replace('.', ',')}`, currentX + colWidths.total/2, yPosition + 7, { align: 'center' });
                currentX += colWidths.total;
                
                // Linha direita da tabela
                doc.line(currentX, yPosition - 2, currentX, yPosition + rowHeight - 2);
                
                // Linha horizontal inferior
                doc.line(margin, yPosition + rowHeight - 2, pageWidth - margin, yPosition + rowHeight - 2);
                
                yPosition += rowHeight;
            });

            // Linha final da tabela
            doc.setLineWidth(0.5);
            doc.setDrawColor(255, 107, 53);
            doc.line(margin, yPosition, pageWidth - margin, yPosition);
            
            yPosition += 15;

            // Total geral com destaque
            doc.setFillColor(255, 107, 53);
            doc.rect(margin + 100, yPosition - 5, 90, 20, 'F');
            
            doc.setFontSize(14);
            doc.setFont('Roboto', 'bold');
            doc.setTextColor(255, 255, 255);
            doc.text('TOTAL GERAL:', margin + 105, yPosition + 5);
            doc.setFontSize(16);
            doc.text(`R$ ${dadosOrcamento.totalGeral.toFixed(2).replace('.', ',')}`, margin + 185, yPosition + 10, { align: 'right' });

            yPosition += 30;

            // Observa√ß√µes com melhor posicionamento
            const observacoes = document.getElementById('observacoes').value.trim();
            if (observacoes && yPosition < 220) {
                doc.setFontSize(12);
                doc.setFont('Roboto', 'bold');
                doc.setTextColor(255, 107, 53);
                doc.text('OBSERVA√á√ïES:', margin, yPosition);
                yPosition += 10;

                doc.setFontSize(10);
                doc.setFont('Roboto', 'normal');
                doc.setTextColor(0, 0, 0);
                const linhasObservacoes = doc.splitTextToSize(observacoes, pageWidth - 2 * margin);
                
                // Verificar se as observa√ß√µes cabem na p√°gina
                const alturaObservacoes = linhasObservacoes.length * 5;
                if (yPosition + alturaObservacoes > 250) {
                    doc.addPage();
                    yPosition = 30;
                    
                    doc.setFontSize(12);
                    doc.setFont('Roboto', 'bold');
                    doc.setTextColor(255, 107, 53);
                    doc.text('OBSERVA√á√ïES:', margin, yPosition);
                    yPosition += 10;
                    
                    doc.setFontSize(10);
                    doc.setFont('Roboto', 'normal');
                    doc.setTextColor(0, 0, 0);
                }
                
                doc.text(linhasObservacoes, margin, yPosition);
            }

            // Rodap√© com data e validade
            const totalPages = doc.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                
                // Linha separadora do rodap√©
                doc.setLineWidth(0.3);
                doc.setDrawColor(200, 200, 200);
                doc.line(margin, 280, pageWidth - margin, 280);
                
                doc.setFontSize(9);
                doc.setFont('Roboto', 'normal');
                doc.setTextColor(120, 120, 120);
                
                // Data de emiss√£o
                doc.text(`Emitido em: ${dataFormatada}`, margin, 287);
                
                // Validade centralizada
                doc.text('Este or√ßamento tem validade de 30 dias.', pageWidth / 2, 287, { align: 'center' });
                
                // N√∫mero da p√°gina
                doc.text(`P√°gina ${i} de ${totalPages}`, pageWidth - margin, 287, { align: 'right' });
            }

            // Armazenar o PDF gerado
            pdfGerado = doc;
            
            // Mostrar modal de compartilhamento
            document.getElementById('shareModal').style.display = 'flex';
            document.getElementById('successMessage').style.display = 'block';
        }

        // Fun√ß√µes do modal de compartilhamento
        function fecharModal() {
            document.getElementById('shareModal').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        function baixarPDF() {
            if (pdfGerado && dadosOrcamento) {
                const nomeArquivo = `Orcamento_${dadosOrcamento.clienteNome.replace(/\s+/g, '_')}.pdf`;
                pdfGerado.save(nomeArquivo);
                fecharModal();
            }
        }

        function baixarImagem() {
            if (dadosOrcamento) {
                // Criar canvas para a imagem
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Configurar dimens√µes do canvas
                canvas.width = 800;
                canvas.height = 600;
                
                // Fundo branco
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Configura√ß√µes de fonte
                ctx.textAlign = 'left';
                ctx.fillStyle = '#2c3e50';
                
                let yPos = 60;
                
                // T√≠tulo
                ctx.font = 'bold 36px Roboto, Arial, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillStyle = '#FF6B35';
                ctx.fillText('OR√áAMENTO', canvas.width / 2, yPos);
                
                yPos += 60;
                
                // Dados da empresa
                ctx.font = 'bold 20px Roboto, Arial, sans-serif';
                ctx.textAlign = 'left';
                ctx.fillStyle = '#FF6B35';
                ctx.fillText('EMPRESA:', 50, yPos);
                
                yPos += 35;
                ctx.font = '18px Roboto, Arial, sans-serif';
                ctx.fillStyle = '#2c3e50';
                ctx.fillText(dadosOrcamento.empresaNome, 50, yPos);
                
                // Adicionar dados da empresa se dispon√≠veis
                const empresaTelefone = document.getElementById('empresaTelefone').value.trim();
                const empresaEmail = document.getElementById('empresaEmail').value.trim();
                
                if (empresaTelefone) {
                    yPos += 25;
                    ctx.font = '14px Roboto, Arial, sans-serif';
                    ctx.fillStyle = '#666';
                    ctx.fillText(`Tel: ${empresaTelefone}`, 50, yPos);
                }
                
                if (empresaEmail) {
                    yPos += 25;
                    ctx.fillText(`Email: ${empresaEmail}`, 50, yPos);
                }
                
                yPos += 50;
                
                // Dados do cliente
                ctx.font = 'bold 20px Roboto, Arial, sans-serif';
                ctx.fillStyle = '#FF6B35';
                ctx.fillText('CLIENTE:', 50, yPos);
                
                yPos += 35;
                ctx.font = '18px Roboto, Arial, sans-serif';
                ctx.fillStyle = '#2c3e50';
                ctx.fillText(dadosOrcamento.clienteNome, 50, yPos);
                
                yPos += 50;
                
                // Resumo dos itens
                ctx.font = 'bold 20px Roboto, Arial, sans-serif';
                ctx.fillStyle = '#FF6B35';
                ctx.fillText('ITENS:', 50, yPos);
                
                yPos += 35;
                
                // Listar at√© 5 itens principais
                const itensParaMostrar = itens.slice(0, 5);
                ctx.font = '16px Roboto, Arial, sans-serif';
                ctx.fillStyle = '#2c3e50';
                
                itensParaMostrar.forEach((item, index) => {
                    const textoItem = `${index + 1}. ${item.descricao} - Qtd: ${item.quantidade} - R$ ${item.valorTotal.toFixed(2).replace('.', ',')}`;
                    ctx.fillText(textoItem, 50, yPos);
                    yPos += 25;
                });
                
                if (itens.length > 5) {
                    ctx.fillStyle = '#666';
                    ctx.fillText(`... e mais ${itens.length - 5} itens`, 50, yPos);
                    yPos += 25;
                }
                
                yPos += 30;
                
                // Total
                ctx.font = 'bold 28px Roboto, Arial, sans-serif';
                ctx.fillStyle = '#FF6B35';
                ctx.fillText('TOTAL GERAL:', 50, yPos);
                
                yPos += 40;
                ctx.font = 'bold 32px Roboto, Arial, sans-serif';
                ctx.fillStyle = '#2c3e50';
                ctx.fillText(`R$ ${dadosOrcamento.totalGeral.toFixed(2).replace('.', ',')}`, 50, yPos);
                
                // Rodap√©
                yPos = canvas.height - 30;
                ctx.font = '12px Roboto, Arial, sans-serif';
                ctx.fillStyle = '#999';
                ctx.textAlign = 'center';
                ctx.fillText('Or√ßamento v√°lido por 30 dias', canvas.width / 2, yPos);
                
                // Converter canvas para blob e fazer download
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `Orcamento_${dadosOrcamento.clienteNome.replace(/\s+/g, '_')}_Resumo.jpg`;
                    link.style.display = 'none';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    alert('üñºÔ∏è Imagem do or√ßamento baixada com sucesso!');
                    fecharModal();
                }, 'image/jpeg', 0.9);
            }
        }

        // Fechar modal clicando fora dele
        document.getElementById('shareModal').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharModal();
            }
        });

        // Fun√ß√µes de valida√ß√£o
        function validarEmail(email) {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        }

        function validarTelefone(telefone) {
            const regex = /^\(\d{2}\)\s\d{4,5}-\d{4}$/;
            return regex.test(telefone);
        }

        function mostrarErro(campo, mostrar = true) {
            const formGroup = campo.closest('.form-group');
            if (mostrar) {
                formGroup.classList.add('error');
                formGroup.classList.remove('success');
            } else {
                formGroup.classList.remove('error');
                if (campo.value.trim()) {
                    formGroup.classList.add('success');
                } else {
                    formGroup.classList.remove('success');
                }
            }
        }

        function validarCampo(campo) {
            const valor = campo.value.trim();
            const tipo = campo.type;
            const id = campo.id;

            // Se o campo estiver vazio e n√£o for obrigat√≥rio, n√£o mostrar erro
            if (!valor && !campo.required) {
                mostrarErro(campo, false);
                return true;
            }

            // Valida√ß√£o de email
            if (tipo === 'email' && valor) {
                const valido = validarEmail(valor);
                mostrarErro(campo, !valido);
                return valido;
            }

            // Valida√ß√£o de telefone
            if ((id === 'empresaTelefone' || id === 'clienteTelefone') && valor) {
                const valido = validarTelefone(valor);
                mostrarErro(campo, !valido);
                return valido;
            }

            // Campos obrigat√≥rios
            if (campo.required && !valor) {
                mostrarErro(campo, true);
                return false;
            }

            mostrarErro(campo, false);
            return true;
        }

        function formatarTelefone(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 10) {
                value = value.replace(/^(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
            } else {
                value = value.replace(/^(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{5})(\d)/, '$1-$2');
            }
            input.value = value;
            validarCampo(input);
        }

        document.getElementById('clienteTelefone').addEventListener('input', function(e) {
            formatarTelefone(e.target);
        });

        // Valida√ß√£o em tempo real para emails
        document.getElementById('clienteEmail').addEventListener('blur', function(e) {
            validarCampo(e.target);
        });

        // Valida√ß√£o de campos obrigat√≥rios
        document.getElementById('clienteNome').addEventListener('blur', function(e) {
            validarCampo(e.target);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a7b11523bd45a6',t:'MTc1NDQxMTU1OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

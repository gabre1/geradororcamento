<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Or√ßamentos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #FF6B35 0%, #FFA500 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .logo-container {
            margin-bottom: 20px;
        }

        .logo {
            width: 250px;
            height: 100px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
            object-fit: contain;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #FF6B35;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #FF6B35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #FF6B35 0%, #FFA500 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 107, 53, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(86, 171, 47, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .btn-danger:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(255, 65, 108, 0.3);
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .items-table th {
            background: linear-gradient(135deg, #FF6B35 0%, #FFA500 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .items-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .items-table tr:hover {
            background: #f8f9fa;
        }

        .total-section {
            background: linear-gradient(135deg, #FF6B35 0%, #FFA500 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: right;
            margin-top: 20px;
        }

        .total-section h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .total-section p {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Modal de Compartilhamento */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-header h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .modal-header p {
            color: #6c757d;
            font-size: 1rem;
        }

        .share-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .share-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .share-option:hover {
            border-color: #FF6B35;
            background: #fff5f2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.1);
        }

        .share-option-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            flex-shrink: 0;
        }

        .share-option-content h3 {
            margin: 0 0 5px 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .share-option-content p {
            margin: 0;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .email-icon { background: linear-gradient(135deg, #ea4335 0%, #fbbc05 100%); }
        .whatsapp-icon { background: linear-gradient(135deg, #25d366 0%, #128c7e 100%); }
        .link-icon { background: linear-gradient(135deg, #1da1f2 0%, #0d8bd9 100%); }
        .download-icon { background: linear-gradient(135deg, #FF6B35 0%, #FFA500 100%); }

        .modal-footer {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .btn-close {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn-close:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .success-message {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .items-table {
                font-size: 0.9rem;
            }
            
            .items-table th,
            .items-table td {
                padding: 10px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <img src="https://drive.google.com/uc?export=view&id=1_Rj0dAUGkBMIfDnmw7LxjKa_bWZcNQd0" 
                     alt="Fenix Fardamentos Logo" 
                     class="logo"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div style="display: none; color: white; font-size: 24px; font-weight: bold;">
                    üî• FENIX FARDAMENTOS
                </div>
            </div>
            <h1>Gerador de Or√ßamentos</h1>
        </div>

        <div class="content">
            <!-- Dados da Empresa -->
            <div class="section">
                <h2>üè¢ Dados da Empresa</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="empresaNome">Nome da Empresa *</label>
                        <input type="text" id="empresaNome" value="Fenix Fardamentos LTDA" required>
                    </div>
                    <div class="form-group">
                        <label for="empresaCNPJ">CNPJ</label>
                        <input type="text" id="empresaCNPJ" value="12.000.234/0001-18">
                    </div>
                    <div class="form-group">
                        <label for="empresaEndereco">Endere√ßo</label>
                        <input type="text" id="empresaEndereco" value="Rua Pinheiro, 65 - Cidade Universit√°ria">
                    </div>
                    <div class="form-group">
                        <label for="empresaTelefone">Telefone</label>
                        <input type="text" id="empresaTelefone" value="(82) 98814-4752">
                    </div>
                    <div class="form-group">
                        <label for="empresaEmail">E-mail</label>
                        <input type="email" id="empresaEmail" value="fenixfardamentos.al@gmail.com">
                    </div>
                </div>
            </div>

            <!-- Dados do Cliente -->
            <div class="section">
                <h2>üë§ Dados do Cliente</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="clienteNome">Nome do Cliente *</label>
                        <input type="text" id="clienteNome" placeholder="Nome completo ou empresa" required>
                    </div>
                    <div class="form-group">
                        <label for="clienteEmail">E-mail do Cliente</label>
                        <input type="email" id="clienteEmail" placeholder="cliente@email.com">
                    </div>
                    <div class="form-group">
                        <label for="clienteTelefone">Telefone do Cliente</label>
                        <input type="text" id="clienteTelefone" placeholder="(11) 99999-9999">
                    </div>
                </div>
            </div>

            <!-- Adicionar Itens -->
            <div class="section">
                <h2>üì¶ Adicionar Itens ao Or√ßamento</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="itemDescricao">Descri√ß√£o do Item *</label>
                        <input type="text" id="itemDescricao" placeholder="CAMISA UV" required>
                    </div>
                    <div class="form-group">
                        <label for="itemQuantidade">Quantidade *</label>
                        <input type="number" id="itemQuantidade" min="1" value="1" required>
                    </div>
                    <div class="form-group">
                        <label for="itemValorUnitario">Valor Unit√°rio (R$) *</label>
                        <input type="number" id="itemValorUnitario" step="0.01" min="0" placeholder="0,00" required>
                    </div>
                </div>
                <button type="button" class="btn btn-primary" onclick="adicionarItem()">
                    ‚ûï Adicionar Item
                </button>
            </div>

            <!-- Lista de Itens -->
            <div class="section">
                <h2>üìã Itens do Or√ßamento</h2>
                <div id="itensContainer">
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        <h3>Nenhum item adicionado</h3>
                        <p>Adicione itens ao or√ßamento usando o formul√°rio acima</p>
                    </div>
                </div>
            </div>

            <!-- Observa√ß√µes -->
            <div class="section">
                <h2>üìù Observa√ß√µes</h2>
                <div class="form-group">
                    <label for="observacoes">Observa√ß√µes Adicionais</label>
                    <textarea id="observacoes" placeholder="Condi√ß√µes de pagamento, prazo de entrega, garantias, etc."></textarea>
                </div>
            </div>

            <!-- Gerar PDF -->
            <div class="section" style="text-align: center;">
                <button type="button" class="btn btn-success" onclick="gerarPDF()" style="font-size: 1.2rem; padding: 15px 30px;">
                    üìÑ Gerar Or√ßamento em PDF
                </button>
            </div>
        </div>
        
        <!-- Indicador de Vers√£o -->
        <div style="position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 15px; font-size: 11px; font-family: monospace; z-index: 1000;">
            v2.4.0
        </div>
    </div>

    <!-- Modal de Compartilhamento -->
    <div id="shareModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì§ Compartilhar Or√ßamento</h2>
                <p>Escolha como deseja compartilhar ou salvar seu or√ßamento</p>
            </div>

            <div id="successMessage" style="display: none;" class="success-message">
                ‚úÖ Or√ßamento processado com sucesso!
            </div>

            <div class="share-options">
                <div class="share-option" onclick="compartilharEmail()">
                    <div class="share-option-icon email-icon">üìß</div>
                    <div class="share-option-content">
                        <h3>E-mail</h3>
                        <p>Enviar por e-mail</p>
                    </div>
                </div>

                <div class="share-option" onclick="compartilharWhatsApp()">
                    <div class="share-option-icon whatsapp-icon">üì±</div>
                    <div class="share-option-content">
                        <h3>WhatsApp</h3>
                        <p>Compartilhar via WhatsApp</p>
                    </div>
                </div>

                <div class="share-option" onclick="copiarTexto()">
                    <div class="share-option-icon link-icon">üìã</div>
                    <div class="share-option-content">
                        <h3>Copiar Texto</h3>
                        <p>Copiar resumo do or√ßamento</p>
                    </div>
                </div>

                <div class="share-option" onclick="baixarPDF()">
                    <div class="share-option-icon download-icon">‚¨áÔ∏è</div>
                    <div class="share-option-content">
                        <h3>Baixar PDF</h3>
                        <p>Salvar no dispositivo</p>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-close" onclick="fecharModal()">Fechar</button>
            </div>
        </div>
    </div>

    <script>
        let itens = [];
        let contadorItens = 0;

        function adicionarItem() {
            const descricao = document.getElementById('itemDescricao').value.trim();
            const quantidade = parseInt(document.getElementById('itemQuantidade').value);
            const valorUnitario = parseFloat(document.getElementById('itemValorUnitario').value);

            if (!descricao || !quantidade || !valorUnitario) {
                alert('Por favor, preencha todos os campos do item.');
                return;
            }

            const item = {
                id: ++contadorItens,
                descricao,
                quantidade,
                valorUnitario,
                valorTotal: quantidade * valorUnitario
            };

            itens.push(item);
            atualizarTabelaItens();
            limparFormularioItem();
        }

        function removerItem(id) {
            itens = itens.filter(item => item.id !== id);
            atualizarTabelaItens();
        }

        function limparFormularioItem() {
            document.getElementById('itemDescricao').value = '';
            document.getElementById('itemQuantidade').value = '1';
            document.getElementById('itemValorUnitario').value = '';
        }

        function atualizarTabelaItens() {
            const container = document.getElementById('itensContainer');
            
            if (itens.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        <h3>Nenhum item adicionado</h3>
                        <p>Adicione itens ao or√ßamento usando o formul√°rio acima</p>
                    </div>
                `;
                return;
            }

            const totalGeral = itens.reduce((total, item) => total + item.valorTotal, 0);

            container.innerHTML = `
                <table class="items-table">
                    <thead>
                        <tr>
                            <th>Descri√ß√£o</th>
                            <th>Qtd</th>
                            <th>Valor Unit.</th>
                            <th>Total</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${itens.map(item => `
                            <tr>
                                <td>${item.descricao}</td>
                                <td>${item.quantidade}</td>
                                <td>R$ ${item.valorUnitario.toFixed(2).replace('.', ',')}</td>
                                <td>R$ ${item.valorTotal.toFixed(2).replace('.', ',')}</td>
                                <td>
                                    <button class="btn btn-danger" onclick="removerItem(${item.id})">
                                        üóëÔ∏è Remover
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <div class="total-section">
                    <h3>Total Geral</h3>
                    <p>R$ ${totalGeral.toFixed(2).replace('.', ',')}</p>
                </div>
            `;
        }

        // Vari√°veis globais para o PDF
        let pdfGerado = null;
        let dadosOrcamento = null;

        function gerarPDF() {
            const empresaNome = document.getElementById('empresaNome').value.trim();
            const clienteNome = document.getElementById('clienteNome').value.trim();

            if (!empresaNome || !clienteNome) {
                alert('Por favor, preencha pelo menos o nome da empresa e do cliente.');
                return;
            }

            if (itens.length === 0) {
                alert('Adicione pelo menos um item ao or√ßamento.');
                return;
            }

            // Armazenar dados do or√ßamento
            dadosOrcamento = {
                empresaNome,
                clienteNome,
                numeroOrcamento: `OR√á-${Date.now().toString().slice(-6)}`,
                dataFormatada: new Date().toLocaleDateString('pt-BR'),
                totalGeral: itens.reduce((total, item) => total + item.valorTotal, 0)
            };

            // Gerar o PDF e abrir modal
            criarPDF();

        }

        function criarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Configura√ß√µes b√°sicas
            const pageWidth = doc.internal.pageSize.width;
            const margin = 20;
            let yPosition = 20;

            // Adicionar logo da empresa
            const logoImg = new Image();
            logoImg.crossOrigin = 'anonymous';
            logoImg.onload = function() {
                // Logo centralizada no topo
                const logoWidth = 60;
                const logoHeight = 25;
                const logoX = (pageWidth - logoWidth) / 2;
                
                doc.addImage(logoImg, 'PNG', logoX, yPosition, logoWidth, logoHeight);
                yPosition += logoHeight + 15;

                // Continuar com o resto do PDF
                continuarGeracaoPDF(doc, pageWidth, margin, yPosition);
            };
            
            logoImg.onerror = function() {
                // Se a logo n√£o carregar, continuar sem ela
                yPosition += 10;
                continuarGeracaoPDF(doc, pageWidth, margin, yPosition);
            };
            
            logoImg.src = 'https://drive.google.com/uc?export=view&id=1_Rj0dAUGkBMIfDnmw7LxjKa_bWZcNQd0';

        }

        function continuarGeracaoPDF(doc, pageWidth, margin, yPosition) {
            // Cabe√ßalho
            doc.setFontSize(28);
            doc.setFont('Roboto', 'bold');
            doc.setTextColor(44, 62, 80);
            doc.text('OR√áAMENTO', pageWidth / 2, yPosition, { align: 'center' });
            
            yPosition += 25;

            // Dados b√°sicos
            doc.setFontSize(12);
            doc.setFont('Roboto', 'normal');
            doc.text(`Data: ${dadosOrcamento.dataFormatada}`, margin, yPosition);
            
            yPosition += 25;

            // Dados da empresa
            doc.setFontSize(16);
            doc.setFont('Roboto', 'bold');
            doc.setTextColor(255, 107, 53);
            doc.text('DADOS DA EMPRESA:', margin, yPosition);
            yPosition += 12;

            doc.setFontSize(12);
            doc.setFont('Roboto', 'bold');
            doc.setTextColor(0, 0, 0);
            doc.text(dadosOrcamento.empresaNome, margin, yPosition);
            yPosition += 8;

                const empresaCNPJ = document.getElementById('empresaCNPJ').value.trim();
                const empresaEndereco = document.getElementById('empresaEndereco').value.trim();
                const empresaTelefone = document.getElementById('empresaTelefone').value.trim();
                const empresaEmail = document.getElementById('empresaEmail').value.trim();

                doc.setFontSize(10);
                doc.setFont('Roboto', 'normal');
                doc.setTextColor(80, 80, 80);
                
                if (empresaCNPJ) {
                    doc.text(`CNPJ: ${empresaCNPJ}`, margin, yPosition);
                    yPosition += 7;
                }
                if (empresaEndereco) {
                    doc.text(`Endere√ßo: ${empresaEndereco}`, margin, yPosition);
                    yPosition += 7;
                }
                if (empresaTelefone) {
                    doc.text(`Telefone: ${empresaTelefone}`, margin, yPosition);
                    yPosition += 7;
                }
                if (empresaEmail) {
                    doc.text(`E-mail: ${empresaEmail}`, margin, yPosition);
                    yPosition += 7;
                }

                yPosition += 15;

            // Dados do cliente
            doc.setFontSize(16);
            doc.setFont('Roboto', 'bold');
            doc.setTextColor(255, 107, 53);
            doc.text('CLIENTE:', margin, yPosition);
            yPosition += 12;

            doc.setFontSize(12);
            doc.setFont('Roboto', 'bold');
            doc.setTextColor(0, 0, 0);
            doc.text(dadosOrcamento.clienteNome, margin, yPosition);
            yPosition += 8;

            const clienteEmail = document.getElementById('clienteEmail').value.trim();
            const clienteTelefone = document.getElementById('clienteTelefone').value.trim();

            doc.setFontSize(10);
            doc.setFont('Roboto', 'normal');
            doc.setTextColor(80, 80, 80);
            
            if (clienteEmail) {
                doc.text(`E-mail: ${clienteEmail}`, margin, yPosition);
                yPosition += 7;
            }
            if (clienteTelefone) {
                doc.text(`Telefone: ${clienteTelefone}`, margin, yPosition);
                yPosition += 7;
            }

                yPosition += 20;

                // Cabe√ßalho da tabela
                doc.setFontSize(12);
                doc.setFont('Roboto', 'bold');
                doc.setTextColor(255, 107, 53);
                doc.text('DESCRI√á√ÉO', margin, yPosition);
                doc.text('QTD', margin + 90, yPosition, { align: 'center' });
                doc.text('VALOR UNIT.', margin + 120, yPosition, { align: 'center' });
                doc.text('TOTAL', margin + 160, yPosition, { align: 'right' });
                
                // Linha abaixo do cabe√ßalho
                yPosition += 6;
                doc.setLineWidth(0.8);
                doc.setDrawColor(255, 107, 53);
                doc.line(margin, yPosition, pageWidth - margin, yPosition);
                yPosition += 12;

            // Itens
            doc.setFontSize(11);
            doc.setFont('Roboto', 'normal');
            doc.setTextColor(0, 0, 0);

            itens.forEach((item, index) => {
                // Verificar se precisa de nova p√°gina
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 30;
                }

                doc.text(`${index + 1}. ${item.descricao}`, margin, yPosition);
                doc.text(item.quantidade.toString(), margin + 90, yPosition, { align: 'center' });
                doc.text(`R$ ${item.valorUnitario.toFixed(2).replace('.', ',')}`, margin + 120, yPosition, { align: 'center' });
                doc.text(`R$ ${item.valorTotal.toFixed(2).replace('.', ',')}`, margin + 160, yPosition, { align: 'right' });
                
                yPosition += 10;
            });

            // Linha antes do total
            yPosition += 8;
            doc.setLineWidth(0.8);
            doc.setDrawColor(255, 107, 53);
            doc.line(margin, yPosition, pageWidth - margin, yPosition);
            yPosition += 18;

            // Total geral
            doc.setFontSize(18);
            doc.setFont('Roboto', 'bold');
            doc.setTextColor(255, 107, 53);
            doc.text('TOTAL GERAL:', margin + 80, yPosition);
            doc.setTextColor(0, 0, 0);
            doc.text(`R$ ${dadosOrcamento.totalGeral.toFixed(2).replace('.', ',')}`, margin + 160, yPosition, { align: 'right' });

            yPosition += 25;

            // Observa√ß√µes
            const observacoes = document.getElementById('observacoes').value.trim();
            if (observacoes) {
                doc.setFontSize(14);
                doc.setFont('Roboto', 'bold');
                doc.setTextColor(255, 107, 53);
                doc.text('OBSERVA√á√ïES:', margin, yPosition);
                yPosition += 12;

                doc.setFontSize(11);
                doc.setFont('Roboto', 'normal');
                doc.setTextColor(0, 0, 0);
                const linhasObservacoes = doc.splitTextToSize(observacoes, pageWidth - 2 * margin);
                doc.text(linhasObservacoes, margin, yPosition);
                yPosition += linhasObservacoes.length * 6 + 12;
            }

            // Rodap√© simples
            yPosition = 275;
            doc.setFontSize(9);
            doc.setFont('Roboto', 'normal');
            doc.setTextColor(120, 120, 120);
            doc.text('Este or√ßamento tem validade de 30 dias.', margin, yPosition);
            doc.text(`Gerado em ${dadosOrcamento.dataFormatada}`, pageWidth - margin, yPosition, { align: 'right' });

            // Armazenar o PDF gerado
            pdfGerado = doc;
            
            // Mostrar modal de compartilhamento
            document.getElementById('shareModal').style.display = 'flex';
            document.getElementById('successMessage').style.display = 'block';
        }

        // Fun√ß√µes do modal de compartilhamento
        function fecharModal() {
            document.getElementById('shareModal').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        function baixarPDF() {
            if (pdfGerado && dadosOrcamento) {
                const nomeArquivo = `Orcamento_${dadosOrcamento.numeroOrcamento}_${dadosOrcamento.clienteNome.replace(/\s+/g, '_')}.pdf`;
                pdfGerado.save(nomeArquivo);
                fecharModal();
            }
        }

        function compartilharEmail() {
            if (dadosOrcamento && pdfGerado) {
                // Criar blob do PDF
                const pdfBlob = pdfGerado.output('blob');
                const nomeArquivo = `Orcamento_${dadosOrcamento.clienteNome.replace(/\s+/g, '_')}.pdf`;
                
                // Criar URL tempor√°ria para o arquivo
                const pdfUrl = URL.createObjectURL(pdfBlob);
                
                // Criar link tempor√°rio para download
                const link = document.createElement('a');
                link.href = pdfUrl;
                link.download = nomeArquivo;
                link.style.display = 'none';
                document.body.appendChild(link);
                
                // Preparar dados para email
                const assunto = `Or√ßamento - ${dadosOrcamento.empresaNome}`;
                const corpo = `Ol√°,\n\nSegue em anexo o or√ßamento no valor de R$ ${dadosOrcamento.totalGeral.toFixed(2).replace('.', ',')}.\n\nData: ${dadosOrcamento.dataFormatada}\nCliente: ${dadosOrcamento.clienteNome}\n\nPor favor, baixe o arquivo PDF anexo.\n\nAtenciosamente,\n${dadosOrcamento.empresaNome}`;
                
                // Abrir cliente de email
                const mailtoLink = `mailto:?subject=${encodeURIComponent(assunto)}&body=${encodeURIComponent(corpo)}`;
                window.open(mailtoLink, '_blank');
                
                // Fazer download autom√°tico do PDF para anexar
                link.click();
                
                // Limpar
                document.body.removeChild(link);
                URL.revokeObjectURL(pdfUrl);
                
                alert('üìß Cliente de e-mail aberto! O PDF foi baixado para voc√™ anexar manualmente.');
                fecharModal();
            }
        }

        function compartilharWhatsApp() {
            if (dadosOrcamento && pdfGerado) {
                // Criar blob do PDF
                const pdfBlob = pdfGerado.output('blob');
                const nomeArquivo = `Orcamento_${dadosOrcamento.clienteNome.replace(/\s+/g, '_')}.pdf`;
                
                // Criar URL tempor√°ria para o arquivo
                const pdfUrl = URL.createObjectURL(pdfBlob);
                
                // Criar link tempor√°rio para download
                const link = document.createElement('a');
                link.href = pdfUrl;
                link.download = nomeArquivo;
                link.style.display = 'none';
                document.body.appendChild(link);
                
                // Fazer download do PDF
                link.click();
                
                // Preparar mensagem para WhatsApp
                const mensagem = `üßæ *Or√ßamento - ${dadosOrcamento.empresaNome}*\n\nüìÖ Data: ${dadosOrcamento.dataFormatada}\nüë§ Cliente: ${dadosOrcamento.clienteNome}\nüí∞ Valor: R$ ${dadosOrcamento.totalGeral.toFixed(2).replace('.', ',')}\n\nüìé PDF baixado! Anexe o arquivo no WhatsApp.`;
                
                // Abrir WhatsApp
                const whatsappLink = `https://wa.me/?text=${encodeURIComponent(mensagem)}`;
                window.open(whatsappLink, '_blank');
                
                // Limpar
                document.body.removeChild(link);
                URL.revokeObjectURL(pdfUrl);
                
                alert('üì± WhatsApp aberto! O PDF foi baixado para voc√™ anexar na conversa.');
                fecharModal();
            }
        }

        function copiarTexto() {
            if (dadosOrcamento) {
                const textoParaCopiar = `Or√ßamento - ${dadosOrcamento.empresaNome}\nData: ${dadosOrcamento.dataFormatada}\nCliente: ${dadosOrcamento.clienteNome}\nValor: R$ ${dadosOrcamento.totalGeral.toFixed(2).replace('.', ',')}`;
                
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(textoParaCopiar).then(() => {
                        alert('‚úÖ Resumo do or√ßamento copiado para a √°rea de transfer√™ncia!');
                        fecharModal();
                    }).catch(() => {
                        // Fallback para navegadores mais antigos
                        copiarTextoFallback(textoParaCopiar);
                    });
                } else {
                    copiarTextoFallback(textoParaCopiar);
                }
            }
        }

        function copiarTextoFallback(texto) {
            const textarea = document.createElement('textarea');
            textarea.value = texto;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert('‚úÖ Resumo do or√ßamento copiado para a √°rea de transfer√™ncia!');
            fecharModal();
        }

        // Fechar modal clicando fora dele
        document.getElementById('shareModal').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharModal();
            }
        });

        // Formata√ß√£o autom√°tica de campos
        document.getElementById('empresaCNPJ').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/^(\d{2})(\d)/, '$1.$2');
            value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
            value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
            value = value.replace(/(\d{4})(\d)/, '$1-$2');
            e.target.value = value;
        });

        document.getElementById('empresaTelefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/^(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = value;
        });

        document.getElementById('clienteTelefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/^(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = value;
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a76a1be323e119',t:'MTc1NDQwODY1Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
